<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">


    <changeSet id="1" author="Dmitri">
        <sql>
            create table if not exists `roles`(
            `id` int not null primary key auto_increment,
            `role_name` varchar(32) not null)
            default character set = utf8;
        </sql>
    </changeSet>


    <changeSet id="2" author="Dmitri">
        <sql>
            insert ignore into `roles` set `role_name`='ADMIN';
            insert ignore into `roles` set `role_name`='USER';
            insert ignore into `roles` set `role_name`='GUEST';
        </sql>
    </changeSet>

    <changeSet id="3" author="Dmitri">
        <sql>
            create table if not exists `status`(
            `id` int not null primary key auto_increment,
            `status_name` varchar(32) not null)
            default character set = utf8;
        </sql>
    </changeSet>

    <changeSet id="4" author="Dmitri">
        <sql>
            insert ignore into `status` set `status_name`='ACTIVE';
            insert ignore into `status` set `status_name`='BLOCKED';
            insert ignore into `status` set `status_name`='WAIT_ACTIVE';
        </sql>
    </changeSet>

    <changeSet id="5" author="Dmitri">
        <sql>
            create table if not exists `users`(
            `id` int not null primary key auto_increment,
            `first_name` varchar(128) not null,
            `last_name` varchar(128) not null,
            `username` varchar(128) not null,
            `email` varchar(128) not null,
            `password` varchar(128) not null,
            `role_id` int not null,
            `status_id` int not null,
            constraint `users_roles_id_fk`
            foreign key (`role_id`) references `roles` (`id`),
            constraint `users_status_id_fk`
            foreign key (`status_id`) references `status` (`id`))
            default character set = utf8;
        </sql>
    </changeSet>

    <changeSet id="6" author="Dmitri">
        <sql>
            create table if not exists `tokens`(
            `id` int not null primary key auto_increment,
            `token_value` varchar(128) not null,
            `time_create` datetime not null,
            `time_expire` datetime not null,
            `user_id` int not null,
            constraint `tokens_users_id_fk`
            foreign key (`user_id`) references `users` (`id`))
            default character set = utf8;
        </sql>
    </changeSet>

    <changeSet id="7" author="Dmitri">
        <sql>
            insert into `users`(`first_name`,`last_name`,`username`,`email`,`password`,`role_id`,`status_id`) values(
            'Dmitri','Pozharsky','admin',
            'admin@gmail.com','$2a$10$fD0kiEe4M8J52/kXXh8viuxMf4N7pf3fvOz6A646UNEZRYlgegpCm',1,1);
        </sql>
    </changeSet>

    <changeSet id="8" author="Dmitri">
        <sql>
            create table if not exists `categories`(
            `id` int not null primary key auto_increment,
            `category_name` varchar(128) not null)
            default character set = utf8;
        </sql>
    </changeSet>

    <changeSet id="9" author="Dmitri">
        <sql>
            create table if not exists `products`(
            `id` int not null primary key auto_increment,
            `product_name` varchar(255) not null,
            `description` text,
            `price` decimal(6,2) not null,
            `amount` int not null,
            `status` tinyint(1),
            `image` mediumblob,
            `time_create` datetime,
            `category_id` int not null,
            constraint `products_categories_id_fk`
            foreign key (`category_id`) references `categories` (`id`))
            default character set = utf8;
        </sql>
    </changeSet>

    <changeSet id="10" author="Dmitri">
        <sql>
            alter schema `web_project_database` default character set utf8;
        </sql>
    </changeSet>
</databaseChangeLog>
